<hr />

<h2 id="orm-agnostic-design">ORM-Agnostic Design</h2>

<p>cache-kit does <strong>not depend on ORMs</strong>.</p>

<p>It operates on three simple concepts:</p>
<ul>
  <li><strong>Serializable entities</strong> — Any type implementing <code class="language-plaintext highlighter-rouge">CacheEntity</code></li>
  <li><strong>Deterministic cache keys</strong> — Consistent identifiers</li>
  <li><strong>Explicit cache boundaries</strong> — Clear separation via <code class="language-plaintext highlighter-rouge">CacheFeed</code></li>
</ul>

<p>This means:</p>
<ul>
  <li>✅ Swap ORMs without changing cache logic</li>
  <li>✅ Use multiple ORMs in the same application</li>
  <li>✅ Cache data from any source (DB, API, file system)</li>
</ul>

<hr />

<h2 id="supported-orms--database-layers">Supported ORMs &amp; Database Layers</h2>

<h3 id="tier-1-recommended-with-examples">Tier-1: Recommended (with Examples)</h3>

<table>
  <thead>
    <tr>
      <th>ORM</th>
      <th>Status</th>
      <th>Example</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>SQLx</strong></td>
      <td>✅ Full Support</td>
      <td><a href="https://github.com/megamsys/cache-kit.rs/tree/main/examples/actixsqlx">actixsqlx</a></td>
      <td>Async-first, compile-time checked SQL</td>
    </tr>
  </tbody>
</table>

<h3 id="tier-1-compatible-community-examples-welcome">Tier-1: Compatible (Community Examples Welcome)</h3>

<table>
  <thead>
    <tr>
      <th>ORM</th>
      <th>Status</th>
      <th>Example</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>SeaORM</strong></td>
      <td>✅ Compatible</td>
      <td>Community contributions welcome</td>
      <td>Async ORM with migrations</td>
    </tr>
    <tr>
      <td><strong>Diesel</strong></td>
      <td>✅ Compatible</td>
      <td>Community contributions welcome</td>
      <td>Mature, type-safe ORM</td>
    </tr>
    <tr>
      <td><strong>tokio-postgres</strong></td>
      <td>✅ Compatible</td>
      <td>Works with any database layer</td>
      <td>Pure async PostgreSQL client</td>
    </tr>
  </tbody>
</table>

<h3 id="tier-2-any-database-layer">Tier-2: Any Database Layer</h3>

<p>cache-kit works with <strong>any</strong> Rust code that can:</p>
<ol>
  <li>Fetch entities by ID</li>
  <li>Return <code class="language-plaintext highlighter-rouge">Option&lt;T&gt;</code> (entity or not found)</li>
  <li>Implement <code class="language-plaintext highlighter-rouge">DataRepository&lt;T&gt;</code> trait</li>
</ol>

<p>This includes:</p>
<ul>
  <li>Custom SQL builders</li>
  <li>NoSQL databases (MongoDB, DynamoDB)</li>
  <li>REST API clients</li>
  <li>File-based storage</li>
  <li>In-memory data structures</li>
</ul>

<hr />

<h2 id="conceptual-flow">Conceptual Flow</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────┐
│ Database / ORM      │ ← Your choice
└──────────┬──────────┘
           │
           ↓ Fetch entities
┌─────────────────────┐
│ Domain Entities     │ ← impl CacheEntity
└──────────┬──────────┘
           │
           ↓ Cache operations
┌─────────────────────┐
│ cache-kit           │ ← Framework-agnostic
└──────────┬──────────┘
           │
           ↓ Store/retrieve
┌─────────────────────┐
│ Cache Backend       │ ← Redis, Memcached, InMemory
└─────────────────────┘
</code></pre></div></div>

<p><strong>Key principle:</strong> Database models live in your database layer, cache-kit just coordinates caching.</p>

<hr />

<h2 id="sqlx-integration">SQLx Integration</h2>

<p>SQLx is an async, compile-time checked SQL library. It’s the recommended database layer for new projects.</p>

<h3 id="installation">Installation</h3>

<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[dependencies]</span>
<span class="py">cache-kit</span> <span class="p">=</span> <span class="s">"0.9"</span>
<span class="nn">sqlx</span> <span class="o">=</span> <span class="p">{</span> <span class="py">version</span> <span class="p">=</span> <span class="s">"0.8"</span><span class="p">,</span> <span class="py">features</span> <span class="p">=</span> <span class="p">[</span><span class="s">"runtime-tokio"</span><span class="p">,</span> <span class="s">"postgres"</span><span class="p">,</span> <span class="s">"uuid"</span><span class="p">,</span> <span class="s">"chrono"</span><span class="p">]</span> <span class="p">}</span>
<span class="nn">tokio</span> <span class="o">=</span> <span class="p">{</span> <span class="py">version</span> <span class="p">=</span> <span class="s">"1.41"</span><span class="p">,</span> <span class="py">features</span> <span class="p">=</span> <span class="nn">["full"]</span> <span class="p">}</span>
<span class="nn">serde</span> <span class="o">=</span> <span class="p">{</span> <span class="py">version</span> <span class="p">=</span> <span class="s">"0.9"</span><span class="p">,</span> <span class="py">features</span> <span class="p">=</span> <span class="nn">["derive"]</span> <span class="p">}</span>
</code></pre></div></div>

<h3 id="entity-definition">Entity Definition</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span> <span class="n">Serialize</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">CacheEntity</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Serialize,</span> <span class="nd">Deserialize,</span> <span class="nd">sqlx::FromRow)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">User</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">created_at</span><span class="p">:</span> <span class="nn">chrono</span><span class="p">::</span><span class="n">DateTime</span><span class="o">&lt;</span><span class="nn">chrono</span><span class="p">::</span><span class="n">Utc</span><span class="o">&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">CacheEntity</span> <span class="k">for</span> <span class="n">User</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Key</span> <span class="o">=</span> <span class="nb">String</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">cache_key</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Key</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.id</span><span class="nf">.clone</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">cache_prefix</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span> <span class="p">{</span>
        <span class="s">"user"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="repository-implementation">Repository Implementation</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">DataRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">sqlx</span><span class="p">::</span><span class="n">PgPool</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">task</span><span class="p">::</span><span class="n">block_in_place</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">runtime</span><span class="p">::</span><span class="n">Handle</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="n">pool</span><span class="p">:</span> <span class="n">PgPool</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">pool</span><span class="p">:</span> <span class="n">PgPool</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span> <span class="n">pool</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">create</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">User</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="nn">sqlx</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nn">sqlx</span><span class="p">::</span><span class="nd">query_as!</span><span class="p">(</span>
            <span class="n">User</span><span class="p">,</span>
            <span class="s">r#"
            INSERT INTO users (id, username, email)
            VALUES ($1, $2, $3)
            RETURNING *
            "#</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.id</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.username</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.email</span>
        <span class="p">)</span>
        <span class="nf">.fetch_one</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.pool</span><span class="p">)</span>
        <span class="k">.await</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">User</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="n">User</span><span class="p">,</span> <span class="nn">sqlx</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nn">sqlx</span><span class="p">::</span><span class="nd">query_as!</span><span class="p">(</span>
            <span class="n">User</span><span class="p">,</span>
            <span class="s">r#"
            UPDATE users
            SET username = $2, email = $3
            WHERE id = $1
            RETURNING *
            "#</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.id</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.username</span><span class="p">,</span>
            <span class="n">user</span><span class="py">.email</span>
        <span class="p">)</span>
        <span class="nf">.fetch_one</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.pool</span><span class="p">)</span>
        <span class="k">.await</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">delete</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="p">(),</span> <span class="nn">sqlx</span><span class="p">::</span><span class="n">Error</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nn">sqlx</span><span class="p">::</span><span class="nd">query!</span><span class="p">(</span><span class="s">"DELETE FROM users WHERE id = $1"</span><span class="p">,</span> <span class="n">id</span><span class="p">)</span>
            <span class="nf">.execute</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.pool</span><span class="p">)</span>
            <span class="k">.await</span><span class="o">?</span><span class="p">;</span>
        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">DataRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fetch_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="nf">block_in_place</span><span class="p">(||</span> <span class="p">{</span>
            <span class="nn">Handle</span><span class="p">::</span><span class="nf">current</span><span class="p">()</span><span class="nf">.block_on</span><span class="p">(</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">user</span> <span class="o">=</span> <span class="nn">sqlx</span><span class="p">::</span><span class="nd">query_as!</span><span class="p">(</span>
                    <span class="n">User</span><span class="p">,</span>
                    <span class="s">"SELECT * FROM users WHERE id = $1"</span><span class="p">,</span>
                    <span class="n">id</span>
                <span class="p">)</span>
                <span class="nf">.fetch_optional</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.pool</span><span class="p">)</span>
                <span class="k">.await</span>
                <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

                <span class="nf">Ok</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="usage-in-service-layer">Usage in Service Layer</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">sync</span><span class="p">::</span><span class="nb">Arc</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::{</span><span class="n">CacheExpander</span><span class="p">,</span> <span class="nn">strategy</span><span class="p">::</span><span class="n">CacheStrategy</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">backend</span><span class="p">::</span><span class="n">InMemoryBackend</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">UserService</span> <span class="p">{</span>
    <span class="n">repo</span><span class="p">:</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">UserRepository</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="n">cache</span><span class="p">:</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">CacheExpander</span><span class="o">&lt;</span><span class="n">InMemoryBackend</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">UserService</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">repo</span><span class="p">:</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">UserRepository</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">cache</span><span class="p">:</span> <span class="nb">Arc</span><span class="o">&lt;</span><span class="n">CacheExpander</span><span class="o">&lt;</span><span class="n">InMemoryBackend</span><span class="o">&gt;&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span> <span class="n">repo</span><span class="p">,</span> <span class="n">cache</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">get</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">feeder</span> <span class="o">=</span> <span class="n">UserFeeder</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="n">id</span><span class="nf">.to_string</span><span class="p">(),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
        <span class="p">};</span>

        <span class="k">self</span><span class="py">.cache</span><span class="nf">.with</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">feeder</span><span class="p">,</span> <span class="o">&amp;*</span><span class="k">self</span><span class="py">.repo</span><span class="p">,</span> <span class="nn">CacheStrategy</span><span class="p">::</span><span class="n">Refresh</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">feeder</span><span class="py">.user</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">create</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// 1. Insert into database</span>
        <span class="k">let</span> <span class="n">created</span> <span class="o">=</span> <span class="k">self</span><span class="py">.repo</span><span class="nf">.create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">)</span><span class="k">.await</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

        <span class="c1">// 2. Cache the new entity</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">feeder</span> <span class="o">=</span> <span class="n">UserFeeder</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="n">created</span><span class="py">.id</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nf">Some</span><span class="p">(</span><span class="n">created</span><span class="nf">.clone</span><span class="p">()),</span>
        <span class="p">};</span>
        <span class="k">self</span><span class="py">.cache</span><span class="nf">.with</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">feeder</span><span class="p">,</span> <span class="o">&amp;*</span><span class="k">self</span><span class="py">.repo</span><span class="p">,</span> <span class="nn">CacheStrategy</span><span class="p">::</span><span class="n">Refresh</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">created</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">update</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// 1. Update database</span>
        <span class="k">let</span> <span class="n">updated</span> <span class="o">=</span> <span class="k">self</span><span class="py">.repo</span><span class="nf">.update</span><span class="p">(</span><span class="o">&amp;</span><span class="n">user</span><span class="p">)</span><span class="k">.await</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

        <span class="c1">// 2. Invalidate cache and fetch fresh</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">feeder</span> <span class="o">=</span> <span class="n">UserFeeder</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="n">updated</span><span class="py">.id</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="k">self</span><span class="py">.cache</span><span class="nf">.with</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">feeder</span><span class="p">,</span> <span class="o">&amp;*</span><span class="k">self</span><span class="py">.repo</span><span class="p">,</span> <span class="nn">CacheStrategy</span><span class="p">::</span><span class="n">Invalidate</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">updated</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">delete</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// 1. Delete from database</span>
        <span class="k">self</span><span class="py">.repo</span><span class="nf">.delete</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="k">.await</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

        <span class="c1">// 2. Invalidate cache</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">feeder</span> <span class="o">=</span> <span class="n">UserFeeder</span> <span class="p">{</span>
            <span class="n">id</span><span class="p">:</span> <span class="n">id</span><span class="nf">.to_string</span><span class="p">(),</span>
            <span class="n">user</span><span class="p">:</span> <span class="nb">None</span><span class="p">,</span>
        <span class="p">};</span>
        <span class="k">self</span><span class="py">.cache</span><span class="nf">.with</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">feeder</span><span class="p">,</span> <span class="o">&amp;*</span><span class="k">self</span><span class="py">.repo</span><span class="p">,</span> <span class="nn">CacheStrategy</span><span class="p">::</span><span class="n">Invalidate</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

        <span class="nf">Ok</span><span class="p">(())</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>See the complete <a href="https://github.com/megamsys/cache-kit.rs/tree/main/examples/actixsqlx">actixsqlx example</a> for a full working implementation.</p>

<hr />

<h2 id="seaorm-integration">SeaORM Integration</h2>

<p>SeaORM is an async ORM with migrations and schema management.</p>

<h3 id="entity-definition-1">Entity Definition</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">sea_orm</span><span class="p">::</span><span class="nn">entity</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span> <span class="n">Serialize</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">CacheEntity</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Debug,</span> <span class="nd">PartialEq,</span> <span class="nd">DeriveEntityModel,</span> <span class="nd">Serialize,</span> <span class="nd">Deserialize)]</span>
<span class="nd">#[sea_orm(table_name</span> <span class="nd">=</span> <span class="s">"users"</span><span class="nd">)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">Model</span> <span class="p">{</span>
    <span class="nd">#[sea_orm(primary_key)]</span>
    <span class="k">pub</span> <span class="n">id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="nd">#[derive(Copy,</span> <span class="nd">Clone,</span> <span class="nd">Debug,</span> <span class="nd">EnumIter,</span> <span class="nd">DeriveRelation)]</span>
<span class="k">pub</span> <span class="k">enum</span> <span class="n">Relation</span> <span class="p">{}</span>

<span class="k">impl</span> <span class="n">ActiveModelBehavior</span> <span class="k">for</span> <span class="n">ActiveModel</span> <span class="p">{}</span>

<span class="c1">// Implement CacheEntity for the SeaORM Model</span>
<span class="k">impl</span> <span class="n">CacheEntity</span> <span class="k">for</span> <span class="n">Model</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Key</span> <span class="o">=</span> <span class="nb">String</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">cache_key</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Key</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.id</span><span class="nf">.clone</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">cache_prefix</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span> <span class="p">{</span>
        <span class="s">"user"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="repository-implementation-1">Repository Implementation</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">sea_orm</span><span class="p">::{</span><span class="n">DatabaseConnection</span><span class="p">,</span> <span class="n">EntityTrait</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">DataRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">task</span><span class="p">::</span><span class="n">block_in_place</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">tokio</span><span class="p">::</span><span class="nn">runtime</span><span class="p">::</span><span class="n">Handle</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="n">db</span><span class="p">:</span> <span class="n">DatabaseConnection</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">DataRepository</span><span class="o">&lt;</span><span class="nn">user</span><span class="p">::</span><span class="n">Model</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fetch_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="nn">user</span><span class="p">::</span><span class="n">Model</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="nf">block_in_place</span><span class="p">(||</span> <span class="p">{</span>
            <span class="nn">Handle</span><span class="p">::</span><span class="nf">current</span><span class="p">()</span><span class="nf">.block_on</span><span class="p">(</span><span class="k">async</span> <span class="p">{</span>
                <span class="k">let</span> <span class="n">user</span> <span class="o">=</span> <span class="nn">user</span><span class="p">::</span><span class="nn">Entity</span><span class="p">::</span><span class="nf">find_by_id</span><span class="p">(</span><span class="n">id</span><span class="nf">.clone</span><span class="p">())</span>
                    <span class="nf">.one</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="py">.db</span><span class="p">)</span>
                    <span class="k">.await</span>
                    <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

                <span class="nf">Ok</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Community contributions welcome!</strong> Share your SeaORM + cache-kit examples.</p>

<hr />

<h2 id="diesel-integration">Diesel Integration</h2>

<p>Diesel is a mature, type-safe ORM with excellent compile-time guarantees.</p>

<h3 id="entity-definition-2">Entity Definition</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">diesel</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">serde</span><span class="p">::{</span><span class="n">Deserialize</span><span class="p">,</span> <span class="n">Serialize</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">CacheEntity</span><span class="p">;</span>

<span class="nd">#[derive(Queryable,</span> <span class="nd">Selectable,</span> <span class="nd">Clone,</span> <span class="nd">Serialize,</span> <span class="nd">Deserialize)]</span>
<span class="nd">#[diesel(table_name</span> <span class="nd">=</span> <span class="nd">users)]</span>
<span class="k">pub</span> <span class="k">struct</span> <span class="n">User</span> <span class="p">{</span>
    <span class="k">pub</span> <span class="n">id</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">username</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="k">pub</span> <span class="n">email</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">CacheEntity</span> <span class="k">for</span> <span class="n">User</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Key</span> <span class="o">=</span> <span class="nb">String</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">cache_key</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Key</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.id</span><span class="nf">.clone</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">cache_prefix</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="o">&amp;</span><span class="k">'static</span> <span class="nb">str</span> <span class="p">{</span>
        <span class="s">"user"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="repository-implementation-sync">Repository Implementation (Sync)</h3>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">diesel</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">diesel</span><span class="p">::</span><span class="nn">r2d2</span><span class="p">::{</span><span class="n">ConnectionManager</span><span class="p">,</span> <span class="n">Pool</span><span class="p">};</span>
<span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">DataRepository</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="n">pool</span><span class="p">:</span> <span class="n">Pool</span><span class="o">&lt;</span><span class="n">ConnectionManager</span><span class="o">&lt;</span><span class="n">PgConnection</span><span class="o">&gt;&gt;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">DataRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fetch_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">use</span> <span class="k">crate</span><span class="p">::</span><span class="nn">schema</span><span class="p">::</span><span class="nn">users</span><span class="p">::</span><span class="nn">dsl</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

        <span class="k">let</span> <span class="k">mut</span> <span class="n">conn</span> <span class="o">=</span> <span class="k">self</span><span class="py">.pool</span><span class="nf">.get</span><span class="p">()</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

        <span class="k">let</span> <span class="n">user</span> <span class="o">=</span> <span class="n">users</span>
            <span class="nf">.filter</span><span class="p">(</span><span class="n">id</span><span class="nf">.eq</span><span class="p">(</span><span class="n">id</span><span class="p">))</span>
            <span class="py">.first</span><span class="p">::</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span> <span class="n">conn</span><span class="p">)</span>
            <span class="nf">.optional</span><span class="p">()</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span><span class="o">?</span><span class="p">;</span>

        <span class="nf">Ok</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Note:</strong> Diesel is synchronous, which works perfectly with cache-kit’s sync <code class="language-plaintext highlighter-rouge">DataRepository</code> trait.</p>

<p><strong>Community contributions welcome!</strong> Share your Diesel + cache-kit examples.</p>

<hr />

<h2 id="custom-database-layer">Custom Database Layer</h2>

<p>cache-kit works with any custom database layer:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="n">DataRepository</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">CustomRepository</span> <span class="p">{</span>
    <span class="c1">// Your custom database client</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">MyDatabaseClient</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">DataRepository</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">CustomRepository</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fetch_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">MyEntityId</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">MyEntity</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="c1">// Your custom fetching logic</span>
        <span class="k">match</span> <span class="k">self</span><span class="py">.client</span><span class="nf">.query</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">Ok</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="n">data</span><span class="p">))</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nf">Some</span><span class="p">(</span><span class="nn">MyEntity</span><span class="p">::</span><span class="nf">from</span><span class="p">(</span><span class="n">data</span><span class="p">))),</span>
            <span class="nf">Ok</span><span class="p">(</span><span class="nb">None</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Ok</span><span class="p">(</span><span class="nb">None</span><span class="p">),</span>
            <span class="nf">Err</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="nf">Err</span><span class="p">(</span><span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">())),</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="database-best-practices">Database Best Practices</h2>

<h3 id="separate-concerns">Separate Concerns</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>✅ Good:
    Database Models → Repository → Cache → Service → API

❌ Bad:
    Database Models with embedded cache logic
</code></pre></div></div>

<h3 id="repository-pattern">Repository Pattern</h3>

<p>Keep repositories focused on data access:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">impl</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="c1">// ✅ Simple, focused data access</span>
    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">find_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DbError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="nn">sqlx</span><span class="p">::</span><span class="nd">query_as!</span><span class="p">(</span><span class="o">...</span><span class="p">)</span><span class="k">.await</span>
    <span class="p">}</span>

    <span class="c1">// ❌ Don't mix cache logic in repository</span>
    <span class="k">pub</span> <span class="k">async</span> <span class="k">fn</span> <span class="nf">find_by_id_cached</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">DbError</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// BAD: Repository shouldn't know about caching</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="error-handling">Error Handling</h3>

<p>Convert database errors to cache-kit errors:</p>

<div class="language-rust highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">impl</span> <span class="n">DataRepository</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">UserRepository</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fetch_by_id</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">id</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">String</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nb">Result</span><span class="o">&lt;</span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;&gt;</span> <span class="p">{</span>
        <span class="k">self</span><span class="nf">.internal_fetch</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
            <span class="nf">.map_err</span><span class="p">(|</span><span class="n">e</span><span class="p">|</span> <span class="nn">cache_kit</span><span class="p">::</span><span class="nn">Error</span><span class="p">::</span><span class="nf">RepositoryError</span><span class="p">(</span><span class="n">e</span><span class="nf">.to_string</span><span class="p">()))</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="database-migrations">Database Migrations</h2>

<p>cache-kit does not handle database migrations. Use your ORM’s migration tools:</p>

<h3 id="sqlx">SQLx</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlx migrate add create_users_table
</code></pre></div></div>

<p>Edit <code class="language-plaintext highlighter-rouge">migrations/001_create_users_table.sql</code>:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">users</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">username</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">UNIQUE</span><span class="p">,</span>
    <span class="n">created_at</span> <span class="n">TIMESTAMPTZ</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_users_username</span> <span class="k">ON</span> <span class="n">users</span><span class="p">(</span><span class="n">username</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_users_email</span> <span class="k">ON</span> <span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
</code></pre></div></div>

<p>Run migrations:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sqlx migrate run <span class="nt">--database-url</span> postgres://localhost/mydb
</code></pre></div></div>

<h3 id="seaorm">SeaORM</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sea-orm-cli migrate generate create_users_table
</code></pre></div></div>

<h3 id="diesel">Diesel</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>diesel migration generate create_users_table
</code></pre></div></div>

<hr />

<h2 id="next-steps">Next Steps</h2>

<ul>
  <li>Learn about <a href="api-frameworks">API Frameworks and Transport Layers</a></li>
  <li>Explore <a href="serialization">Serialization options</a></li>
  <li>Review <a href="backends">Cache backend choices</a></li>
  <li>See the <a href="https://github.com/megamsys/cache-kit.rs/tree/main/examples/actixsqlx">Actix + SQLx reference implementation</a></li>
</ul>
